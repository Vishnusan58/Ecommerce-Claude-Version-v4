<div class="container">
  <h1>My Wishlist</h1>

  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  }

  @if (!isLoading && wishlist.length === 0) {
    <div class="empty-state">
      <mat-icon>favorite_border</mat-icon>
      <h2>Your wishlist is empty</h2>
      <p>Save items you love for later!</p>
      <button mat-raised-button color="primary" routerLink="/products">
        Browse Products
      </button>
    </div>
  }

  @if (!isLoading && wishlist.length > 0) {
    <div class="wishlist-grid">
      @for (product of wishlist; track getProductId(product)) {
        <mat-card class="wishlist-card">
          @if (product.premiumEarlyAccess) {
            <div class="premium-badge">Early Access</div>
          }
          @if (getDiscountPercent(product) > 0) {
            <div class="discount-badge">-{{ getDiscountPercent(product) }}%</div>
          }

          <img mat-card-image [src]="product.imageUrl" [alt]="product.name" class="product-image" (click)="viewProduct(getProductId(product))" (error)="$any($event.target).src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27300%27 height=%27300%27 viewBox=%270 0 300 300%27%3E%3Crect fill=%27%23f5f5f5%27 width=%27300%27 height=%27300%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 fill=%27%23999%27 font-family=%27sans-serif%27 font-size=%2716%27%3ENo Image%3C/text%3E%3C/svg%3E'">

          <mat-card-content>
            <p class="product-category">{{ getProductCategory(product) }}</p>
            <h3 class="product-name" (click)="viewProduct(getProductId(product))">{{ product.name }}</h3>

            <div class="rating">
              @for (star of [1,2,3,4,5]; track star) {
                <mat-icon>{{ star <= getProductRating(product) ? 'star' : 'star_border' }}</mat-icon>
              }
            </div>

            <div class="price-section">
              <span class="price">₹{{ product.price | number }}</span>
              @if (product.originalPrice && product.originalPrice > product.price) {
                <span class="original-price">₹{{ product.originalPrice | number }}</span>
              }
            </div>

            <p class="stock-status" [class.out-of-stock]="getProductStock(product) === 0">
              {{ getProductStock(product) > 0 ? 'In Stock' : 'Out of Stock' }}
            </p>
          </mat-card-content>

          <mat-card-actions>
            <button mat-raised-button color="primary" (click)="moveToCart(product)" [disabled]="getProductStock(product) === 0">
              <mat-icon>add_shopping_cart</mat-icon>
              Move to Cart
            </button>
            <button mat-icon-button color="warn" (click)="removeFromWishlist(product)">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  }
</div>
